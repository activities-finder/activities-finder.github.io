(()=>{var m=class{constructor(t,r){R(t,r);let n=new URLSearchParams(window.location.search.substring(1));this.criteriaNameConverterMap=r,this.buildCriteriaMap(A(n,t,r))}getCriteria(t,r){return this.criteriaMap.hasOwnProperty(t)?this.criteriaMap[t]:r}setStringCriteria(t,r){r!==""?this.criteriaMap[t]=r:delete this.criteriaMap[t]}setAnyCriteria(t,r){this.criteriaMap[t]=r}setArrayCriteria(t,r){r.length>0?this.criteriaMap[t]=r:delete this.criteriaMap[t]}setBoolCriteria(t,r){r===!0?this.criteriaMap[t]=r:delete this.criteriaMap[t]}removeAlias(t,r){let i=this.getCriteria(t,[]).filter(s=>s!==r);this.setArrayCriteria(t,i)}remove(t){delete this.criteriaMap[t]}keep(...t){for(let r in this.criteriaMap)t.indexOf(r)===-1&&delete this.criteriaMap[r]}storeCurrentState(){this.buildCriteriaMap(this.criteriaMap),this.update()}update(){window.history.pushState(null,"",window.location.pathname+E(this.criteria))}buildCriteriaMap(t){let r=[];for(let n in t)if(t.hasOwnProperty(n)){let i=this.criteriaNameConverterMap[n];r.push(n+"="+encodeURIComponent(i.marshal(t[n])))}this.criteriaMap=t,this.criteria=r.join("&")}};function A(e,t,r){let n={};for(let i=0;i<t.length;i++){let s=t[i];if(e.has(s)){let u=r[s],c=decodeURIComponent(e.get(s)).trim();if(c!==""){let p=u.unmarshal(c);p!==null&&(n[s]=p)}}}return n}function E(e){if(e==="")return"";let t=[];return e!==""&&t.push(e),"?"+t.join("&")}function R(e,t){for(let r=0;r<e.length;r++){let n=e[r];if(!t.hasOwnProperty(n))throw new Error(`missing converter for "${n}"`)}}var d=class{unmarshal(t){return t}marshal(t){return t}};var h=class{constructor(){this.list=[],this.map={}}unique(t){if(this.map.hasOwnProperty(t))throw new Error(`already exists: ${t}`);return this.map[t]=!0,this.list.push(t),t}names(){return this.list}};var y=new h,f=y.unique("url"),l=y.unique("q"),w=y.names();var x=new d,T=new m(w,{[f]:x,[l]:x}),o=T;function M(e){function t(i,s){i.value=e.getCriteria(s,"")}function r(i,s){i.setState(e.getCriteria(s,[]))}function n(i,s){i.checked=e.getCriteria(s,!1)}return{setInputStateByURL:t,setCheckboxesStateByURL:r,setCheckboxStateByURL:n}}function I(e){return function(t){t.code==="Enter"&&e()}}{let c=function(g){if(r.value===""){n=[],i.innerHTML="";return}n=[],fetch(r.value).then(function(a){return a.text()}).then(function(a){n=[new DOMParser().parseFromString(a,"text/html").querySelector("ul.items")],g()}).catch(console.error)},p=function(){let g=[],a=o.getCriteria(l,"").toLowerCase();for(let S of n)for(let C of S.children)(a===""||C.textContent.toLowerCase().indexOf(a)!==-1)&&g.push(C.cloneNode(!0));i.innerHTML="",i.append(...g)},b=function(){o.setStringCriteria(f,r.value),o.storeCurrentState(),c(()=>{})},v=function(){o.setStringCriteria(l,u.value),o.storeCurrentState(),p()},{setInputStateByURL:e}=M(o),t=document.getElementById("js-url-form"),r=t.elements.url,n=[],i=document.getElementById("js-content-comments"),s=document.getElementById("js-activities-form"),u=s.elements.search;e(r,f),e(u,l),r.addEventListener("keyup",I(b)),u.addEventListener("keyup",I(v)),t.onsubmit=b,s.onsubmit=v,c(p)}})();
