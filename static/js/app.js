(()=>{var d=class{constructor(t,e){F(t,e);let n=new URLSearchParams(window.location.search.substring(1));this.criteriaNameConverterMap=e,this.buildCriteriaMap(j(n,t,e))}getCriteria(t,e){return this.criteriaMap.hasOwnProperty(t)?this.criteriaMap[t]:e}setStringCriteria(t,e){e!==""?this.criteriaMap[t]=e:delete this.criteriaMap[t]}setAnyCriteria(t,e){this.criteriaMap[t]=e}setArrayCriteria(t,e){e.length>0?this.criteriaMap[t]=e:delete this.criteriaMap[t]}setBoolCriteria(t,e){e===!0?this.criteriaMap[t]=e:delete this.criteriaMap[t]}removeAlias(t,e){let i=this.getCriteria(t,[]).filter(s=>s!==e);this.setArrayCriteria(t,i)}remove(t){delete this.criteriaMap[t]}keep(...t){for(let e in this.criteriaMap)t.indexOf(e)===-1&&delete this.criteriaMap[e]}storeCurrentState(){this.buildCriteriaMap(this.criteriaMap),this.update()}update(){window.history.pushState(null,"",window.location.pathname+D(this.criteria))}buildCriteriaMap(t){let e=[];for(let n in t)if(t.hasOwnProperty(n)){let i=this.criteriaNameConverterMap[n];e.push(n+"="+encodeURIComponent(i.marshal(t[n])))}this.criteriaMap=t,this.criteria=e.join("&")}};function j(r,t,e){let n={};for(let i=0;i<t.length;i++){let s=t[i];if(r.has(s)){let C=e[s],T=decodeURIComponent(r.get(s)).trim();if(T!==""){let p=C.unmarshal(T);p!==null&&(n[s]=p)}}}return n}function D(r){if(r==="")return"";let t=[];return r!==""&&t.push(r),"?"+t.join("&")}function F(r,t){for(let e=0;e<r.length;e++){let n=r[e];if(!t.hasOwnProperty(n))throw new Error(`missing converter for "${n}"`)}}var S=class{unmarshal(t){return t}marshal(t){return t}},A=class{unmarshal(t){return t==="1"}marshal(t){return t===!0?"1":""}};var y=class{constructor(){this.list=[],this.map={}}unique(t){if(this.map.hasOwnProperty(t))throw new Error(`already exists: ${t}`);return this.map[t]=!0,this.list.push(t),t}names(){return this.list}};var R=new y,I=R.unique("url"),f=R.unique("q"),g=R.unique("supported"),H=R.names();var q=new S,N=new A,Q=new d(H,{[I]:q,[f]:q,[g]:N}),u=Q;function Y(r){function t(i,s){i.value=r.getCriteria(s,"")}function e(i,s){i.setState(r.getCriteria(s,[]))}function n(i,s){i.checked=r.getCriteria(s,!1)}return{setInputStateByURL:t,setCheckboxesStateByURL:e,setCheckboxStateByURL:n}}function w(r){return function(t){t.code==="Enter"&&r()}}{let B=function(a,o){a.addEventListener("change",function(){u.setBoolCriteria(o,a.checked),u.storeCurrentState(),v()})},O=function(a){let o=a.querySelectorAll(".page");if(o.length===0)return 1;let l=o[o.length-1];return parseInt(l.textContent,10)},U=function(a){let o=i.value;if(o===""){s=[],C.innerHTML="";return}s=[],fetch(o).then(function(l){return l.text()}).then(function(l){let E=new DOMParser().parseFromString(l,"text/html");s=[E.querySelector("ul.items")];let M=O(E);if(M===1){a();return}let c=Math.min(3,M),h=[];for(let m=2;m<=c;m++)h.push(fetch(`${o}/${m}/`));Promise.all(h).then(function(m){return Promise.all(m.map(x=>x.text()))}).then(function(m){for(let x of m){let V=new DOMParser().parseFromString(x,"text/html");s.push(V.querySelector("ul.items"))}a()})}).catch(console.error)},v=function(){let a=[],o=0,l=u.getCriteria(f,"").toLowerCase(),_=u.getCriteria(g,!1),E=function(){return l===""?function(c){return!0}:function(c){return c.querySelector(".comment-item .b-typo").textContent.toLowerCase().indexOf(l)!==-1}}(),M=function(){return _===!1?function(c){return!0}:function(c){return c.querySelector(".sup-users")!==null}}();for(let c of s)for(let h of c.children)o+=1,M(h)&&E(h)&&a.push(h.cloneNode(!0));T.innerHTML=`${a.length} from ${o}`,C.innerHTML="",C.append(...a)},$=function(){u.setStringCriteria(I,i.value),u.storeCurrentState(),U(()=>{})},P=function(){u.setStringCriteria(f,b.value),u.storeCurrentState(),v()},{setInputStateByURL:t,setCheckboxStateByURL:e}=Y(u),n=document.getElementById("js-url-form"),i=n.elements.url,s=[],C=document.getElementById("js-content-comments"),T=document.getElementById("js-stats"),p=document.getElementById("js-activities-form"),b=p.elements.search,L=p.elements.supported;t(i,I),t(b,f),e(L,g),i.addEventListener("keyup",w($)),b.addEventListener("keyup",w(P)),B(L,g),n.onsubmit=$,p.onsubmit=P,U(v)}})();
