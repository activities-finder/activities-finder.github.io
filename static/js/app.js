(()=>{"use strict";const t=new class{constructor(){this.list=[],this.map={}}unique(t){if(this.map.hasOwnProperty(t))throw new Error(`already exists: ${t}`);return this.map[t]=!0,this.list.push(t),t}names(){return this.list}},e=t.unique("url"),r=t.unique("q"),n=t.unique("supported"),i=t.names(),s=new class{unmarshal(t){return t}marshal(t){return t}},o=new class{unmarshal(t){return"1"===t}marshal(t){return!0===t?"1":""}},a=new class{constructor(t,e){!function(t,e){for(let r=0;r<t.length;r++){const n=t[r];if(!e.hasOwnProperty(n))throw new Error(`missing converter for "${n}"`)}}(t,e);const r=new URLSearchParams(window.location.search.substring(1));this.criteriaNameConverterMap=e,this.buildCriteriaMap(function(t,e,r){const n={};for(let i=0;i<e.length;i++){const s=e[i];if(t.has(s)){const e=r[s],i=decodeURIComponent(t.get(s)).trim();if(""!==i){const t=e.unmarshal(i);null!==t&&(n[s]=t)}}}return n}(r,t,e))}getCriteria(t,e){return this.criteriaMap.hasOwnProperty(t)?this.criteriaMap[t]:e}setStringCriteria(t,e){""!==e?this.criteriaMap[t]=e:delete this.criteriaMap[t]}setAnyCriteria(t,e){this.criteriaMap[t]=e}setArrayCriteria(t,e){e.length>0?this.criteriaMap[t]=e:delete this.criteriaMap[t]}setBoolCriteria(t,e){!0===e?this.criteriaMap[t]=e:delete this.criteriaMap[t]}removeAlias(t,e){const r=this.getCriteria(t,[]).filter((t=>t!==e));this.setArrayCriteria(t,r)}remove(t){delete this.criteriaMap[t]}keep(...t){for(let e in this.criteriaMap)-1===t.indexOf(e)&&delete this.criteriaMap[e]}storeCurrentState(){this.buildCriteriaMap(this.criteriaMap),this.update()}update(){window.history.pushState(null,"",window.location.pathname+function(t){if(""===t)return"";const e=[];return""!==t&&e.push(t),"?"+e.join("&")}(this.criteria))}buildCriteriaMap(t){const e=[];for(let r in t)if(t.hasOwnProperty(r)){const n=this.criteriaNameConverterMap[r];e.push(r+"="+encodeURIComponent(n.marshal(t[r])))}this.criteriaMap=t,this.criteria=e.join("&")}}(i,{[e]:s,[r]:s,[n]:o});function c(t){return function(e){"Enter"===e.code&&t()}}{const l=12,{setInputStateByURL:h,setCheckboxStateByURL:p}=(u=a,{setInputStateByURL:function(t,e){t.value=u.getCriteria(e,"")},setCheckboxesStateByURL:function(t,e){t.setState(u.getCriteria(e,[]))},setCheckboxStateByURL:function(t,e){t.checked=u.getCriteria(e,!1)}}),f=document.getElementById("js-url-form"),m=f.elements.url;let d=[];const C=document.getElementById("js-content-comments"),g=document.getElementById("js-stats"),y=document.getElementById("js-activities-form"),M=y.elements.search,w=y.elements.supported;function S(t,e){t.addEventListener("change",(function(){a.setBoolCriteria(e,t.checked),a.storeCurrentState(),x()}))}function v(t){const e=t.querySelectorAll(".page");if(0===e.length)return 1;const r=e[e.length-1];return parseInt(r.textContent,10)}function L(t){const e=m.value;if(""===e)return d=[],void(C.innerHTML="");d=[],fetch(e).then((function(t){return t.text()})).then((function(r){const n=(new DOMParser).parseFromString(r,"text/html");d=[n.querySelector("ul.items")];const i=v(n);if(1===i)return void t();const s=Math.min(l,i),o=[];for(let t=2;t<=s;t++)o.push(fetch(`${e}/${t}/`));Promise.all(o).then((function(t){return Promise.all(t.map((t=>t.text())))})).then((function(e){for(const t of e){const e=(new DOMParser).parseFromString(t,"text/html");d.push(e.querySelector("ul.items"))}t()}))})).catch(console.error)}function x(){const t=[];let e=0;const i=a.getCriteria(r,"").toLowerCase(),s=a.getCriteria(n,!1),o=""===i?function(t){return!0}:function(t){return-1!==t.querySelector(".comment-item .b-typo").textContent.toLowerCase().indexOf(i)},c=!1===s?function(t){return!0}:function(t){return null!==t.querySelector(".sup-users")};for(const r of d)for(const n of r.children)e+=1,c(n)&&o(n)&&t.push(n.cloneNode(!0));g.innerHTML=`${t.length} from ${e}`,C.innerHTML="",C.append(...t)}function B(){a.setStringCriteria(e,m.value),a.storeCurrentState(),L((()=>{}))}function b(){a.setStringCriteria(r,M.value),a.storeCurrentState(),x()}h(m,e),h(M,r),p(w,n),m.addEventListener("keyup",c(B)),M.addEventListener("keyup",c(b)),S(w,n),f.onsubmit=B,y.onsubmit=b,L(x)}var u})();