(()=>{var g=class{constructor(t,r){Y(t,r);let e=new URLSearchParams(window.location.search.substring(1));this.criteriaNameConverterMap=r,this.buildCriteriaMap(q(e,t,r))}getCriteria(t,r){return this.criteriaMap.hasOwnProperty(t)?this.criteriaMap[t]:r}setStringCriteria(t,r){r!==""?this.criteriaMap[t]=r:delete this.criteriaMap[t]}setAnyCriteria(t,r){this.criteriaMap[t]=r}setArrayCriteria(t,r){r.length>0?this.criteriaMap[t]=r:delete this.criteriaMap[t]}setBoolCriteria(t,r){r===!0?this.criteriaMap[t]=r:delete this.criteriaMap[t]}removeAlias(t,r){let n=this.getCriteria(t,[]).filter(s=>s!==r);this.setArrayCriteria(t,n)}remove(t){delete this.criteriaMap[t]}keep(...t){for(let r in this.criteriaMap)t.indexOf(r)===-1&&delete this.criteriaMap[r]}storeCurrentState(){this.buildCriteriaMap(this.criteriaMap),this.update()}update(){window.history.pushState(null,"",window.location.pathname+B(this.criteria))}buildCriteriaMap(t){let r=[];for(let e in t)if(t.hasOwnProperty(e)){let n=this.criteriaNameConverterMap[e];r.push(e+"="+encodeURIComponent(n.marshal(t[e])))}this.criteriaMap=t,this.criteria=r.join("&")}};function q(i,t,r){let e={};for(let n=0;n<t.length;n++){let s=t[n];if(i.has(s)){let I=r[s],h=decodeURIComponent(i.get(s)).trim();if(h!==""){let m=I.unmarshal(h);m!==null&&(e[s]=m)}}}return e}function B(i){if(i==="")return"";let t=[];return i!==""&&t.push(i),"?"+t.join("&")}function Y(i,t){for(let r=0;r<i.length;r++){let e=i[r];if(!t.hasOwnProperty(e))throw new Error(`missing converter for "${e}"`)}}var y=class{unmarshal(t){return t}marshal(t){return t}};var C=class{constructor(){this.list=[],this.map={}}unique(t){if(this.map.hasOwnProperty(t))throw new Error(`already exists: ${t}`);return this.map[t]=!0,this.list.push(t),t}names(){return this.list}};var v=new C,d=v.unique("url"),p=v.unique("q"),L=v.names();var $=new y,j=new g(L,{[d]:$,[p]:$}),c=j;function U(i){function t(n,s){n.value=i.getCriteria(s,"")}function r(n,s){n.setState(i.getCriteria(s,[]))}function e(n,s){n.checked=i.getCriteria(s,!1)}return{setInputStateByURL:t,setCheckboxesStateByURL:r,setCheckboxStateByURL:e}}function w(i){return function(t){t.code==="Enter"&&i()}}{let P=function(a){let o=a.querySelectorAll(".page");if(o.length===0)return 1;let l=o[o.length-1];return parseInt(l.textContent,10)},x=function(a){let o=e.value;if(o===""){n=[],s.innerHTML="";return}n=[],fetch(o).then(function(l){return l.text()}).then(function(l){let f=new DOMParser().parseFromString(l,"text/html");n=[f.querySelector("ul.items")];let R=P(f);if(R===1){a();return}let _=Math.min(3,R),T=[];for(let u=2;u<=_;u++)T.push(fetch(`${o}/${u}/`));Promise.all(T).then(function(u){return Promise.all(u.map(b=>b.text()))}).then(function(u){for(let b of u){let H=new DOMParser().parseFromString(b,"text/html");n.push(H.querySelector("ul.items"))}a()})}).catch(console.error)},M=function(){let a=[],o=0,l=c.getCriteria(p,"").toLowerCase();console.log("$originalCommentPageGroup",n);for(let E of n)for(let f of E.children)o+=1,(l===""||f.textContent.toLowerCase().indexOf(l)!==-1)&&a.push(f.cloneNode(!0));I.innerHTML=`${a.length} from ${o}`,s.innerHTML="",s.append(...a)},S=function(){c.setStringCriteria(d,e.value),c.storeCurrentState(),x(()=>{})},A=function(){c.setStringCriteria(p,m.value),c.storeCurrentState(),M()},{setInputStateByURL:t}=U(c),r=document.getElementById("js-url-form"),e=r.elements.url,n=[],s=document.getElementById("js-content-comments"),I=document.getElementById("js-stats"),h=document.getElementById("js-activities-form"),m=h.elements.search;t(e,d),t(m,p),e.addEventListener("keyup",w(S)),m.addEventListener("keyup",w(A)),r.onsubmit=S,h.onsubmit=A,x(M)}})();
